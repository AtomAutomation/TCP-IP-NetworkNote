## 15 套接字和标准I/O 

### 15.1 标准I/O 函数的优点

#### 15.1.1 标准I/O的两个优点

- 标准 I/O 函数具有良好的移植性
- 标准 I/O 函数可以利用缓冲提高性能

良好移植性： 标准函数时按照ANSIC标准定义的

额外的缓冲: 创建套接字时，操作系统会生成用于I/O的缓冲，而若使用标准I/O函数

![](https://camo.githubusercontent.com/fa4d05ae67e35866b82fbe9e0084f50c0e0fc595/68747470733a2f2f692e6c6f6c692e6e65742f323031392f30312f32392f356335303065353361643961612e706e67)

假设使用 fputs 函数进行传输字符串 「Hello」时，首先将数据传递到标准 I/O 缓冲，然后将数据移动到套接字输出缓冲，最后将字符串发送到对方主机。

设置缓冲的目的是为了提高性能，套接字中的缓冲主要是为了实现TCP协议而设立的(如再次发送丢失的数据)，I/O函数缓冲是为了提供性能

- 传输的数据量
- 数据向输出缓冲移动的次数

发送10个每个为1字节的数据包和发送一个10字节的数据包，显然因为头信息的存在，10个数据包会传输更多数据量，而且为了发送数据，向套接字输出缓冲移动数据也会消耗不少时间

#### 15.1.2 标准I/O和系统函数之间的性能对比

对于未提供缓冲的read和write函数来说，传输很慢，而标准I/O输入则较快

#### 15.1.3 标准I/O函数的几个缺点

- 不容易进行双向通信
- 有时可能频繁调用fflush函数
- 需要以FILE结构体指针的形式返回文件描述符

打开文件时，如果希望同时进行读写操作，则应以r+，w+，a+模式打开，但因为缓冲的缘故